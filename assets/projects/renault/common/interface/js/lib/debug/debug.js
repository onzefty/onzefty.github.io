import e from"../emitter/emitter-mixin.js";import{EVENTS as t,noop as n}from"../utils/utils.js";const o="ðŸš§ [DebugMode] â€¢â€¢â€¢â€¢ LOGGER â€¢â€¢â€¢â€¢ ðŸš€",r=Symbol(),i=console,s={error:i.error,warn:i.warn},c=window.confirm,l=window.prompt,a=window.alert,u={error:0,warn:0},d=[];let m=null,p={},w=[],f=null,g=!1,E=!1,h=!1,b=!1,D=!1,L="",y=0;class K extends e{static get UNKNOWN(){return"DebugMode.unknown"}static get LEFT(){return"DebugMode.left"}static get RIGHT(){return"DebugMode.right"}static get UP(){return"DebugMode.up"}static get DOWN(){return"DebugMode.down"}static get PRESS(){return"DebugMode.press"}static get ENABLED(){return"DebugMode.enabled"}static get DISABLED(){return"DebugMode.disabled"}static get LOGS_ENABLED(){return"DebugMode.console.enabled"}static get LOGS_DISABLED(){return"DebugMode.console.disabled"}static get ACTIVE(){return E}static get LOG(){return G}static get LOG_GROUP(){return O}static get LOG_GROUP_COLLAPSE(){return v}static get LOG_GROUP_END(){return U}constructor(e,t){if(f)return f;super(),f=this,this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.boundHandleKeyUp=this.handleKeyUp.bind(this),E=e,h=void 0!==t?t:e,f=this}get active(){return E}get activeConsole(){return h}init(){g||(this.initEvents(window),console.error=function(){D&&u.error++,s.error.apply(console,arguments)},console.warn=function(){D&&u.warn++,s.warn.apply(console,arguments)},window.addEventListener("error",(function(){D&&(u.error++,U())})),A(),g=!0)}initEvents(e){e.document.addEventListener(t.KEYDOWN,this.boundHandleKeyDown),e.document.addEventListener(t.KEYUP,this.boundHandleKeyUp),m=e,w.includes(e)||(p[w.length]={console:e.console,consoleFunctions:{error:e.console.error,warn:e.console.warn},confirm:e.confirm,prompt:e.prompt,alert:e.alert},w.push(e)),E?M():Y(),h?R():k()}removeEvents(e){e.document.removeEventListener(t.KEYDOWN,this.boundHandleKeyDown),e.document.removeEventListener(t.KEYUP,this.boundHandleKeyUp),R(),Y(),m=null,p={},w.length=0}handleKeyUp(e){const t=e.key;if(P(e)&&1===t.length){const e=d.indexOf(t);e>-1&&d.splice(e,1)}N()}handleKeyDown(e){const t=(e.key||"none").toLowerCase();if(P(e)&&1===t.length){if(d.includes(t))return!1;d.push(t),function(){const e=d.join("");"d"===e&&(E=!E,b=!0,d.length=0);"l"===e&&(h=!h,b=!0,d.length=0);b&&A()}(),N(),e.stopPropagation(),e.preventDefault()}}log(){G(arguments)}logGroup(){O(arguments)}logGroupCollapse(){v(arguments)}logGroupEnd(){U()}}function v(){O.apply(this,[r,...arguments])}function O(){const e=[...arguments];let t=!1;for(let n=0;n<e.length;n++){if(e[n]===r){t=!0,e.splice(n,1);break}}if(e.length<=0||!h)return;(t?console.groupCollapsed:console.group).apply(console,[o,...e]),D=!0,L=e[0]}function U(){if(!h)return;console.groupEnd(),D=!1;const e=o;u.error>0&&console.error(e,L,`[ERROR : ${u.error}]`),u.warn>0&&console.warn(e,L,`[WARN : ${u.warn}]`),function(){for(const[e,t]of Object.entries(u))u[e]=0}(),L=""}function G(){if(arguments.length<=0||!h)return;let e=arguments;D||(e=[o,...e]),console.log.apply(console,e)}function P(e){return!!e&&!(!e.shiftKey||!e.ctrlKey)}function N(){clearTimeout(y),y=setTimeout((()=>{d.length=0}),1e3)}function S(e){if(!E||!f)return!1;const t=e.key,n=()=>{e.stopPropagation()};let o=K.UNKNOWN;switch(t){case"Left":case"ArrowLeft":o=K.LEFT,n();break;case"Right":case"ArrowRight":o=K.RIGHT,n();break;case"Up":case"ArrowUp":o=K.UP,n();break;case"Down":case"ArrowDown":o=K.DOWN,n()}f.emit(K.PRESS,{key:o,baseKey:t,code:e.keyCode,shift:e.shiftKey,ctrl:e.ctrlKey,alt:e.altKey,meta:e.metaKey})}function A(){E?E&&(M(),f&&(f.emit(K.ENABLED,{combination:b}),b=!1)):E||(Y(),f&&(f.emit(K.DISABLED,{combination:b}),b=!1)),h?h&&(R(),f&&(f.emit(K.LOGS_ENABLED,{combination:b}),b=!1)):h||(k(),f&&(f.emit(K.LOGS_DISABLED,{combination:b}),b=!1))}function R(){if(window.console=i,window.confirm=c,window.prompt=l,window.alert=a,m){const e=w.indexOf(m);if(e>-1){const t=p[e];m.console=t.console,m.confirm=t.confirm,m.prompt=t.prompt,m.alert=t.alert}}}function k(){window.console={assert:()=>{},clear:()=>{},count:()=>{},countReset:()=>{},debug:()=>{},error:()=>{},info:()=>{},log:()=>{},table:()=>{},trace:()=>{},warn:()=>{},dir:()=>{},dirxml:()=>{},group:()=>{},groupCollapsed:()=>{},groupEnd:()=>{},time:()=>{},timeLog:()=>{},timeEnd:()=>{},exception:()=>{},timeStamp:()=>{},profile:()=>{},profileEnd:()=>{},context:()=>{},memory:()=>{},markTimeline:()=>{},select:()=>{},timeline:()=>{},timelineEnd:()=>{},takeHeapSnapshot:()=>{},cd:()=>{}},window.confirm=n,window.prompt=n,window.alert=n,m&&(m.console=window.console,m.confirm=n,m.prompt=n,m.alert=n)}function M(){if(!E)return;const e=m||window;document.removeEventListener(t.KEYUP,S,!0),w.forEach((e=>{e.document.removeEventListener(t.KEYUP,S,!0)})),e.document.addEventListener(t.KEYUP,S,!0)}function Y(){if(E)return;const e=m||window;document.removeEventListener(t.KEYUP,S,!0),w.forEach((e=>{e.document.removeEventListener(t.KEYUP,S,!0)})),e.document.removeEventListener(t.KEYUP,S,!0)}export{K as default};
